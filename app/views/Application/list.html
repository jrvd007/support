#{extends 'main.html' /}
#{set title:'Système de Support' /}
#{set section:'Requêtes' /}


#{if requetes==null || requetes.size() == 0}
	<p class = "aucune">
	Aucune requête.
	</p>
#{/if}

#{else}
	<div id = "accordion">
	<ul class = "requetes">
	<div class = "seperation">
	<li class = "requetehead">
		<span class = "idreqhead">#</span>
		<span class = "createur">Créateur</span>
		<span class = "sujet">Sujet</span>
		<span class = "categorie">Catégorie</span>
		<span class = "statut">Statut</span>
		<span class = "datehead">Date</span>
	</li>
	</div>
    #{list items:requetes, as: 'requete'}
	<div class = "seperation">
        <li class="header">
			<a href="#" class = "requetea">
				%{createur = requete.createur;}%
				<span class = "idreq">${requete.id}</span>
				<span class = "createur">${createur.prenom} ${createur.nom}</span>
				%{suj = requete.sujet.length()>20? requete.sujet.substring(0,20)+"..." : requete.sujet;}%
				<span class = "sujet">${suj}</span>
				<span class = "categorie">${requete.categorie}</span>
				<span class = "statut">${requete.statut?: "Non Assignée"}</span>
				<span class = "date">
            			${requete.creation.format('dd MMMM yyyy', 'fr')}
				</span>
			</a>
 	</li>
  <div class = "floatleft"><p>${requete.description}</p></div>
    #{if requete.createur == user}
    <form id="nouveauCommentaire" action="@{Application.commentaire()}" method="POST">
        <input type="hidden" name="requete_id" value="${requete.id}" />
        <textarea name="text" id="commentaireText" rows=3 cols=40>Nouveau commentaire.</textarea>
      <input type="submit" value="Ajouter commentaire" />
      </form>
    #{/if}

    #{if requete.commentaires.size() >= 1}
    <ul class="commentaires">
      #{list items:requete.commentaires, as: 'commentaire'}
      <li class="commentaire" id="commentaire_${commentaire.id}">
        <span class="date">${commentaire.date.format('dd MMMM yyyy', 'fr')}</span>
        :
        <span class="commentaire_text">${commentaire.text}</span>
      </li>
      #{/list}
    </ul>
    #{/if}
	</div>
    #{/list}
	</ul>
	</div>
#{/else}

<script>
	$(function() {
		$( "#accordion" ).accordion({ header: 'li.header', collapsible: true });
	});
</script>
